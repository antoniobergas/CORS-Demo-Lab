
<!DOCTYPE html>
<html>
<head>
    <title>Iframe CORS  Demo</title>
</head><h3>The iframe CORS Example</h3>

<body>

<!-- -------------------------------------------------------------------------------------------- -->
<!-- -------------------------------------------------------------------------------------------- -->
<!--                       Set up 2 iFrames                                                       -->
<!-- go run static-web.go TLD 8081 & go run static-web.go sub1 3000 & go run static-web.go sub2 3001 & -->
<!-- -------------------------------------------------------------------------------------------- -->
<!-- -------------------------------------------------------------------------------------------- -->
    <h3> iframe 1 </h3>
<iframe style="border: 10 solid black; width:100%; height: 200px; overflow: auto;" id="iframe1">
</iframe>



<h3> iframe 2 </h3>
<iframe style=" border: 10 solid black; width:100%; height: 200px; overflow: auto;"  id="iframe2">
</iframe>
<p id="response"></p>
<br>

<!-- -------------------------------------------------------------------------------------------- -->
<!-- -------------------------------------------------------------------------------------------- -->
<!--                       Setup  Parent                                                    -->
<!-- -------------------------------------------------------------------------------------------- -->
<!-- -------------------------------------------------------------------------------------------- -->

<!-- -------------------------------------------------------------------------------------------- -->
<!--                       Setup  Buttons to send msg to iframs                                   -->
<!-- -------------------------------------------------------------------------------------------- -->

<h3> Parent Window </h3>
<button type="button" id="sendtochild1" > Send Message to iframe 1  </button>
<button type="button" id="sendtochild2" > Send Message to iframe 2  </button>
<br>

<script>

        // ------------------------------------------------------------------------------------
        // -------------------- Add event listeners to iframes to send msgs via button click to iframes
        // ------------------------------------------------------------------------------------
        function clickHandler (e) {
            //console.log("i am postmessagin");
            document.getElementById(e.currentTarget.myParam).contentWindow.postMessage('Parent sending to iframe: ',
            '*'); //could be generic too like '*'
            }
        document.getElementById("sendtochild1").addEventListener('click',clickHandler,false);
        document.getElementById("sendtochild1").myParam = "iframe1"
        document.getElementById("sendtochild2").addEventListener('click',clickHandler,false);
        document.getElementById("sendtochild2").myParam = "iframe2"

        // ------------------------------------------------------------------------------------
        // -------------------- Event listeners to receive message from iframes
        // ------------------------------------------------------------------------------------
        let count=1
        var messageEventHandler = function(event){
        // check that the origin is one we want.
            if(
                 event.data != undefined && (typeof event.data) == 'string'
                ) 
                {
                console.log('parent window receving:  '+ event.data)
                document.getElementById("response").innerHTML = event.data  + count;
                count += 1
                }            
            }           
       window.addEventListener('message', messageEventHandler,false);


</script>

</body>
<script>
      // ------------------------------------------------------------------------------------
        // -------------------- Setup Iframes with parameters
        // ------------------------------------------------------------------------------------
    // http://localhost:8081/main-web-same-origin.html?url1=http://localhost:8081/subweb.html&url2=http://localhost:8081/subweb.html
    // http://localhost:8081/main-web-same-origin.html?url1=http://localhost:3000/subweb.html&url2=http://localhost:3001/subweb.html
    const urlParams = new URL(window.location.toLocaleString()).searchParams;
    let url = urlParams.get('url1');
    let myIframe = document.getElementById("iframe1")
    myIframe.src = url
    myIframe = document.getElementById("iframe2")
    url = urlParams.get('url2');
    myIframe.src = url

</script>
</html>

